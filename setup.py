#!/usr/bin/env python3
"""
TestGenius Setup Script
Helps users install dependencies and configure the environment
"""

import os
import sys
import subprocess
from pathlib import Path

def print_banner():
    """Print welcome banner"""
    print("=" * 60)
    print("ğŸ¤– TestGenius Setup - AI-Powered Test Documentation")
    print("=" * 60)
    print()

def check_python_version():
    """Check if Python version is compatible"""
    print("ğŸ” Checking Python version...")
    
    if sys.version_info < (3, 8):
        print("âŒ Python 3.8 or higher is required")
        print(f"   Current version: {sys.version}")
        sys.exit(1)
    
    print(f"âœ… Python {sys.version.split()[0]} is compatible")
    print()

def install_dependencies():
    """Install required dependencies"""
    print("ğŸ“¦ Installing dependencies...")
    
    try:
        subprocess.check_call([
            sys.executable, "-m", "pip", "install", "-r", "requirements.txt"
        ])
        print("âœ… Dependencies installed successfully")
    except subprocess.CalledProcessError:
        print("âŒ Failed to install dependencies")
        print("   Please run: pip install -r requirements.txt")
        sys.exit(1)
    
    print()

def setup_environment():
    """Set up environment configuration"""
    print("âš™ï¸ Setting up environment configuration...")
    
    env_file = Path(".env")
    example_file = Path("config.env.example")
    
    if env_file.exists():
        print("âœ… .env file already exists")
        return
    
    if not example_file.exists():
        print("âŒ config.env.example not found")
        return
    
    # Copy example to .env
    with open(example_file, 'r') as src, open(env_file, 'w') as dst:
        dst.write(src.read())
    
    print("âœ… Created .env file from template")
    print("ğŸ“ Please edit .env file with your actual configuration")
    print()

def create_documents_folder():
    """Create documents folder if it doesn't exist"""
    print("ğŸ“ Setting up documents folder...")
    
    docs_folder = Path("documents")
    if not docs_folder.exists():
        docs_folder.mkdir()
        print("âœ… Created documents folder")
    else:
        print("âœ… Documents folder already exists")
    
    print()

def print_configuration_guide():
    """Print configuration guide"""
    print("ğŸ“‹ Configuration Guide:")
    print("-" * 30)
    print()
    
    print("1. Azure OpenAI Setup:")
    print("   â€¢ Create an Azure OpenAI resource")
    print("   â€¢ Deploy a GPT-4 model")
    print("   â€¢ Get your endpoint, API key, and deployment name")
    print()
    
    print("2. Jira API Setup:")
    print("   â€¢ Go to Jira â†’ Profile â†’ Personal Access Tokens")
    print("   â€¢ Create a new token with appropriate permissions")
    print("   â€¢ Use your email and the token for authentication")
    print()
    
    print("3. Confluence Setup (Optional):")
    print("   â€¢ Uses same credentials as Jira by default")
    print("   â€¢ Can be configured separately if needed")
    print()
    
    print("4. Edit .env file with your configuration:")
    print("   â€¢ AZURE_OPENAI_ENDPOINT")
    print("   â€¢ AZURE_OPENAI_API_KEY")
    print("   â€¢ AZURE_OPENAI_DEPLOYMENT_NAME")
    print("   â€¢ JIRA_SERVER")
    print("   â€¢ JIRA_USERNAME")
    print("   â€¢ JIRA_API_TOKEN")
    print()

def print_usage_guide():
    """Print usage guide"""
    print("ğŸš€ Usage Guide:")
    print("-" * 20)
    print()
    
    print("Autonomous Mode (Recommended):")
    print("   python autonomous_test_genius.py")
    print("   â€¢ Fully autonomous workflow")
    print("   â€¢ Minimal human intervention")
    print("   â€¢ Agent-based processing")
    print()
    
    print("Interactive Mode:")
    print("   python test_genius_chatbot.py")
    print("   â€¢ Step-by-step guided workflow")
    print("   â€¢ Manual control over each phase")
    print("   â€¢ Detailed progress tracking")
    print()

def main():
    """Main setup function"""
    print_banner()
    
    # Check Python version
    check_python_version()
    
    # Install dependencies
    install_dependencies()
    
    # Setup environment
    setup_environment()
    
    # Create documents folder
    create_documents_folder()
    
    # Print guides
    print_configuration_guide()
    print_usage_guide()
    
    print("=" * 60)
    print("ğŸ‰ Setup completed successfully!")
    print("ğŸ“ Next steps:")
    print("   1. Edit .env file with your configuration")
    print("   2. Run: python autonomous_test_genius.py")
    print("=" * 60)

if __name__ == "__main__":
    main() 